<!DOCTYPE html>
<html lang="id" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title >Detail Produk</title> <!-- Title updated by JS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="https://supergames19.github.io/onlain/EdyStore/style.css">
    <!-- html2canvas for JPG saving -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body class="detail-page"> <!-- Added page class -->
    <header class="site-header">
         <nav class="navbar" aria-label="Main Navigation">
            <div class="container navbar-container">
                <a href="index.html" class="brand-logo" contenteditable="true">EdyStore</a>
                <ul class="nav-links" id="nav-menu">
                    <li><a href="index.html" class="nav-link" >Beranda</a></li>
                    <li><a href="index.html#produk" class="nav-link" >Koleksi</a></li>
                    <li><a href="keranjang.html" class="nav-link cart-link">
                        <i data-feather="shopping-bag" contenteditable="false"></i>
                        <span >Keranjang</span> (<span id="cart-count">0</span>)
                    </a></li>
                    <li><a href="index.html#kontak" class="nav-link" >Kontak</a></li>
                </ul>
                 <div class="nav-actions">
                    <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle Light/Dark Theme">
                        <i data-feather="sun" class="sun-icon" contenteditable="false"></i>
                        <i data-feather="moon" class="moon-icon" contenteditable="false"></i>
                    </button>
                    <button class="menu-toggle" id="menu-toggler" aria-label="Toggle Menu" aria-expanded="false" aria-controls="nav-menu">
                        <i data-feather="menu" contenteditable="false"></i>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <main role="main" class="section-padding">
        <div class="container product-detail-container"> <!-- Container for product details -->
            <!-- Breadcrumb Navigation -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <ol>
                    <li><a href="index.html" >Beranda</a></li>
                    <li><a href="index.html#produk" >Koleksi</a></li>
                    <li><span id="breadcrumb-product-name" aria-current="page">Memuat...</span></li> <!-- Updated by JS -->
                </ol>
            </nav>

            <!-- Layout Grid -->
            <div class="product-detail-layout">
                <!-- Product Image Section -->
                <div class="product-image-gallery">
                    <!-- The container triggers upload, targets the specific img#product-image -->
                    <div class="editable-image-container" data-target-img-selector="#product-image">
                        <img id="product-image" src="img/placeholder.png" alt="Gambar Utama Produk" class="main-product-image editable-image"> <!-- Placeholder initial -->
                    </div>
                    <!-- Optional Thumbnails could go here -->
                </div>

                <!-- Product Information Section -->
                <div class="product-info-details">
                    <h1 id="product-name" class="product-detail-title" >Memuat Nama Produk...</h1> <!-- Editable -->
                    <span class="product-price large" id="product-price" >Rp 0</span> <!-- Price Editable -->

                    <div class="product-description">
                        <h3 >Deskripsi</h3>
                        <p id="product-description" >Memuat deskripsi produk...</p> <!-- Editable -->
                    </div>

                    <!-- Quantity Control -->
                     <div class="quantity-control">
                        <label for="quantity" >Jumlah:</label>
                        <div class="quantity-input-wrapper">
                            <button class="quantity-btn minus" aria-label="Kurangi Jumlah" type="button">-</button>
                            <input type="number" id="quantity" name="quantity" value="1" min="1" aria-label="Jumlah Produk">
                            <button class="quantity-btn plus" aria-label="Tambah Jumlah" type="button">+</button>
                        </div>
                     </div>

                    <!-- Add to Cart Button -->
                    <button class="btn btn-primary btn-lg btn-block add-to-cart-btn" id="detail-add-to-cart" data-id="" data-name="" data-price="">
                        <i data-feather="shopping-cart" class="btn-icon" contenteditable="false"></i> <span >Tambah ke Keranjang</span>
                    </button>

                     <!-- Additional Information -->
                    <div class="additional-info">
                        <p><i data-feather="package" contenteditable="false"></i> <span >Stok: Tersedia</span></p>
                        <p><i data-feather="shield" contenteditable="false"></i> <span >Garansi Pengembalian Dana</span></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

     <footer class="site-footer section-padding">
        <div class="container">
           <p contenteditable="true">Â© <span id="current-year-footer"></span> EdyStore. All Rights Reserved.</p>
            <p contenteditable="true">Simulasi Toko Online - By: Edy Sahputra</p>
        </div>
    </footer>

    <!-- Action Toolbar -->
    <div class="action-toolbar">
        <button id="save-html-btn" class="btn btn-secondary btn-sm" title="Simpan Halaman sebagai HTML Statis">Simpan HTML</button>
        <button id="save-jpg-btn" class="btn btn-secondary btn-sm" title="Simpan Tampilan Halaman sebagai Gambar JPG">Simpan JPG</button>
        <!-- Add Product button hidden on detail page via CSS -->
        
    </div>

    <!-- Toast Notification Placeholder -->
    <div id="toast-notification" class="toast" role="alert" aria-live="assertive"></div>

    <!-- Loading Overlay Placeholder -->
    <div id="loading-overlay" class="loading-overlay" aria-hidden="true">
        <div class="loading-spinner" role="status" aria-label="Loading"></div>
        <p>Memproses...</p>
    </div>

    <!-- Main script MUST be loaded before the inline script -->
    <script src="https://supergames19.github.io/onlain/EdyStore/script.js"></script>
    <!-- Inline script specific to detail-produk.html -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Detail Page DOMContentLoaded: Initializing...");

            // --- Check for AuraStore ---
            if (typeof AuraStore === 'undefined') {
                 console.error("AuraStore main script not loaded or failed!");
                 document.querySelector('.product-detail-container').innerHTML = `<h1>Error Kritis</h1><p>Gagal memuat script utama aplikasi.</p>`;
                 return;
            }

            // --- Get Product ID from URL ---
            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id');

            // --- Get references to page elements ---
            const productNameEl = document.getElementById('product-name');
            const productPriceEl = document.getElementById('product-price');
            const productDescEl = document.getElementById('product-description');
            const productImageEl = document.getElementById('product-image');
            const breadcrumbNameEl = document.getElementById('breadcrumb-product-name');
            const detailAddToCartBtn = document.getElementById('detail-add-to-cart');
            const container = document.querySelector('.product-detail-container');
            const quantityInput = document.getElementById('quantity');
            const minusBtn = document.querySelector('.quantity-btn.minus');
            const plusBtn = document.querySelector('.quantity-btn.plus');
            const placeholderImg = 'img/placeholder.png'; // Define fallback image

            // --- Check if essential elements exist ---
            if (!productNameEl || !productPriceEl || !productDescEl || !productImageEl || !detailAddToCartBtn || !breadcrumbNameEl || !container || !quantityInput || !minusBtn || !plusBtn) {
                console.error("Essential detail page elements missing. Aborting detail setup.");
                if (container) container.innerHTML = `<h1>Error Halaman</h1><p>Gagal memuat detail produk karena elemen halaman tidak lengkap.</p><a href="index.html" class="btn btn-primary">Kembali ke Beranda</a>`;
                // Optionally disable editing/saving features if page load fails
                document.querySelector('.action-toolbar')?.remove();
                return; // Stop execution
            }

            // --- Fetch and Display Product Data ---
            if (!productId) {
                 console.error("Product ID missing from URL.");
                 document.title = "ID Produk Tidak Valid - AuraStore";
                 container.innerHTML = `
                     <nav aria-label="breadcrumb" class="breadcrumb-nav"><ol><li><a href="index.html">Beranda</a></li></ol></nav>
                     <h1>ID Produk Tidak Valid</h1>
                     <p>Parameter ID produk tidak ditemukan di URL.</p>
                     <a href="index.html" class="btn btn-primary">Kembali ke Beranda</a>`;
                 return;
            }

            // Use the centralized function from AuraStore to get data
            const productData = AuraStore.getProductData(productId);

            if (productData) {
                console.log(`Loading data for product ID: ${productId}`, productData);

                // Update page title
                document.title = `${productData.name} - AuraStore`;

                // Populate elements with data
                productNameEl.textContent = productData.name;
                productPriceEl.textContent = AuraStore.formatPrice(productData.price); // Use formatter
                productDescEl.textContent = productData.description;
                breadcrumbNameEl.textContent = productData.name;

                // --- Set Image Source using AuraStore helper ---
                const imageSrc = AuraStore.getProductImageSource(productId, productData.image || placeholderImg);
                productImageEl.src = imageSrc;
                productImageEl.alt = `Gambar ${productData.name}`;
                productImageEl.onerror = () => { // Fallback if stored or default fails
                    console.warn(`Image failed to load for ${productId} from ${imageSrc}, using placeholder.`);
                    productImageEl.src = placeholderImg;
                    productImageEl.alt = 'Gambar tidak tersedia';
                };
                // Ensure the data-id matches for the image editor target
                productImageEl.dataset.id = productId;


                // Set data attributes for the Add to Cart button
                detailAddToCartBtn.dataset.id = productId;
                detailAddToCartBtn.dataset.name = productData.name;
                // Store the raw price number in the button's data attribute
                detailAddToCartBtn.dataset.price = productData.price;

                // --- Setup Quantity Controls ---
                minusBtn.addEventListener('click', () => {
                    let currentVal = parseInt(quantityInput.value);
                    if (currentVal > 1) {
                         quantityInput.value = currentVal - 1;
                         minusBtn.disabled = (currentVal - 1) <= 1; // Disable if new value is 1
                    }
                });

                plusBtn.addEventListener('click', () => {
                    let currentVal = parseInt(quantityInput.value);
                    quantityInput.value = currentVal + 1;
                    minusBtn.disabled = false; // Ensure minus is enabled when increasing
                });

                 // Ensure value is always at least 1 on change/blur, and update button state
                 const validateQuantity = () => {
                     let currentVal = parseInt(quantityInput.value);
                     if (isNaN(currentVal) || currentVal < 1) {
                         quantityInput.value = 1;
                         currentVal = 1;
                     }
                     minusBtn.disabled = currentVal <= 1;
                 };
                 quantityInput.addEventListener('change', validateQuantity);
                 quantityInput.addEventListener('blur', validateQuantity);

                 // Initial state for minus button
                 minusBtn.disabled = (parseInt(quantityInput.value) <= 1);

            } else {
                // Handle product not found more gracefully
                console.error(`Product with ID '${productId}' not found in data store or cart.`);
                document.title = "Produk Tidak Ditemukan - AuraStore";
                container.innerHTML = `
                    <nav aria-label="breadcrumb" class="breadcrumb-nav"><ol><li><a href="index.html">Beranda</a></li></ol></nav>
                    <h1>Produk Tidak Ditemukan</h1>
                    <p>Maaf, produk yang Anda cari tidak tersedia atau ID tidak valid.</p>
                    <a href="index.html" class="btn btn-primary">Kembali ke Beranda</a>`;
                 document.querySelector('.action-toolbar')?.remove(); // Hide toolbar if product not found
            }

             // --- Update Cart Count in Header ---
             // Call this after potential cart interactions on other pages might have happened
             AuraStore.updateCartCount();

             // --- Re-initialize Feather Icons if needed ---
             // Main script might have run first, but Feather might need re-run if icons added dynamically
             if (typeof feather !== 'undefined') {
                 try { feather.replace(); } catch(e) { console.error("Feather replace error in detail inline script:", e); }
             }

             console.log("Detail Page Initialization Complete.");
        });
    </script>
</body>
</html>